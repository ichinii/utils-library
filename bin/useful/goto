#!/bin/bash

req "xdotool"
req "tput"

libpath="$ul_tmpdir/gotolib"
usage="Usage:\tgoto -n <id> <path>\n\tgoto <id>\n\tgoto -l"

if [ ! -f "$libpath" ]; then
	touch "$libpath"
fi

if [ -z "$1" ]; then
	echo -e "$usage"
	exit
fi

if [ $1 == "-l" ]; then
	while read LINE
	do
		printf ${LINE%:*}
		printf " -> "
		printf ${LINE#*:}
		echo
	done < $libpath
	exit
fi

if [ $1 == "-n" ]; then
	if [ -n "$3" ]; then # TODO missing: error if ID already defined
		echo "$2:$3" >> $libpath
	else
		echo "goto: Too few arguments | goto -n <id> <path>"
	fi
else
	id=$1
	line=$(grep "$id:" $libpath)
	line=${line#*:}
	if [ -n "$line" ]; then
		xdotool type --clearmodifiers "cd $line"
		xdotool key --clearmodifiers Return
		tput cuu 2
		tput ed 1
	else
		echo "id '$1' not found"
	fi
fi
